[platformio]
; switch this when you want to build others (simulide / uno_hw / native)
default_envs = uno_r4_minima

; ---------------- SimulIDE (AVR sim) ----------------
[env:simulide]
platform = atmelavr
board = uno
framework = arduino
monitor_speed = 115200
lib_deps =
   arduino-libraries/LiquidCrystal@^1.0.7
   thomasfredericks/Bounce2@^2.72
upload_protocol = custom
upload_command = /bin/sh -lc 'mkdir -p "$PROJECT_DIR/out/simulide" && cp "$PROJECT_BUILD_DIR/$PIOENV/${PROGNAME}.hex" "$PROJECT_DIR/out/simulide/firmware.hex" && /Applications/simulide.app/Contents/MacOS/simulide "../../wiring/rocker_launcher_controls.sim1" &'

; ---------------- Real UNO R3 (AVR) ----------------
[env:uno_hw]
platform = atmelavr
board = uno
framework = arduino
monitor_speed = 115200
build_flags = -DARDUINO_ARCH_AVR
lib_deps =
   arduino-libraries/LiquidCrystal@^1.0.7
   thomasfredericks/Bounce2@^2.72

; ---------------- UNO R4 Minima (Renesas RA4M1) ----------------
[env:uno_r4_minima]
platform = renesas-ra
board = uno_r4_minima
framework = arduino
monitor_speed = 115200
build_flags = -DARDUINO_ARCH_RENESAS
lib_deps =
   arduino-libraries/LiquidCrystal@^1.0.7
   thomasfredericks/Bounce2@^2.72
; If upload has trouble, uncomment and set the exact port:
; upload_port = /dev/cu.usbmodemXXXX
; board_build.flash_mode can be set if needed, but defaults are fine for R4.

; ---------------- Native tests ----------------
[env:native]
platform = native
build_flags =
    -std=c++17
    -Wall -Wextra -Wpedantic
    -DUNITY_INCLUDE_DOUBLE
    -DUNITY_DOUBLE_PRECISION=1e-12
    -DARDUINO=0
    -DUNITY_INCLUDE_CONFIG_H
test_framework = unity
test_build_src = yes
test_filter = test_*
test_ignore =
    test_manual_*
    test_integration_*
build_src_filter =
    -<main.cpp>
    +<ArduinoInterface.h>
    +<RocketController.h>
    +<RocketController.cpp>

